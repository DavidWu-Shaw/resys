@model VendorModel

<div id="book-time" class="book-main">
    <div class="fieldset">
        <div class="form-fields" id="booking-calendar">
            <div class="column-left">
                <div id="navigator"></div>
            </div>
            <div class="column-main">
                <div id="scheduler"></div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var nav = new DayPilot.Navigator("navigator");
    nav.onTimeRangeSelected = function (args) {
        var day = args.day;

        if (dp.visibleStart() <= day && day < dp.visibleEnd()) {
            dp.scrollTo(day, "fast");
        }
        else {
            var start = day.firstDayOfMonth();
            var days = day.daysInMonth();
            dp.startDate = start;
            dp.days = days;
            dp.update();
            dp.scrollTo(day, "fast");
            loadEvents();
        }
    };

    nav.init();

    var dp = new DayPilot.Scheduler("scheduler");
    dp.treeEnabled = false;
    dp.heightSpec = "Max";
    dp.height = 300;
    dp.scale = "Hour";
    dp.startDate = DayPilot.Date.today().firstDayOfMonth();
    dp.days = DayPilot.Date.today().daysInMonth();
    dp.cellWidth = 40;
    dp.eventHeight = 40;
    dp.durationBarVisible = false;
    dp.treePreventParentUsage = true;

    dp.onBeforeEventRender = function (args) {
    };

    dp.onBeforeCellRender = function (args) {
        if (args.cell.isParent) {
            return;
        }
        if (args.cell.start < new DayPilot.Date()) {  // past
            return;
        }
        if (args.cell.utilization() > 0) {
            return;
        }
        var color = "green";
        var slotId = args.cell.start.toString("HH:mm");
        var text = "";
        args.cell.html = "<div style='cursor: default; position: absolute; left: 0px; top:0px; right: 0px; bottom: 0px; padding-left: 3px; text-align: center; background-color: " + color + "; color:white;'>" + text + "</div>";
    };

    dp.timeHeaders = [
        { groupBy: "Month", format: "MMMM yyyy" },
        { groupBy: "Day", format: "dddd, MMMM d" },
        { groupBy: "Hour", format: "h tt" }
    ];

    dp.businessBeginsHour = 6;
    dp.businessEndsHour = 23;
    dp.businessWeekends = true;
    dp.showNonBusiness = false;
    dp.allowEventOverlap = false;
    //dp.cellWidthSpec = "Auto";
    dp.bubble = new DayPilot.Bubble();

    dp.onTimeRangeSelecting = function (args) {
        if (args.start < new DayPilot.Date()) {
            args.right.enabled = true;
            args.right.html = "You can't create a reservation in the past";
            args.allowed = false;
        }
        else if (args.duration.totalHours() > 4) {
            args.right.enabled = true;
            args.right.html = "You can only book up to 4 hours";
            args.allowed = false;
        }
    };

    // event creating
    // http://api.daypilot.org/daypilot-scheduler-ontimerangeselected/
    dp.onTimeRangeSelected = function (args) {
        var modal = new DayPilot.Modal();
        modal.onClosed = function (args) {
            dp.clearSelection();
            loadEvents();
        };
        modal.showUrl("new.php?start=" + args.start + "&end=" + args.end + "&resource=" + args.resource);
    };

    dp.init();

    var scrollTo = DayPilot.Date.today();
    if (new DayPilot.Date().getHours() > 12) {
        scrollTo = scrollTo.addHours(12);
    }
    dp.scrollTo(scrollTo);

    loadResources();
    loadEvents();

    function loadResources() {
        var url = "@Url.Action("GetResourcesByVendor", "Catalog")" + "?vendorId=@Model.Id";
        console.log(url);
        dp.rows.load(url);
    }

    function loadEvents() {
    }
</script>
